<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>–¢—Ä–µ–∫–µ—Ä —Ä–∞—Å—Ö–æ–¥–æ–≤ ‚Äî Supabase</title>
  <style>
    :root{
      --bg:#f7f7fb; --paper:#ffffff; --text:#1f2328; --muted:#5b6168;
      --line:#e8e8ef; --accent:#6f1b28; --accent-ink:#fff;
      --radius:14px; --pad:18px; --maxw:720px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font:16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg); color:var(--text);
    }
    .wrap{max-width:var(--maxw); margin:40px auto; padding:0 16px}
    .card{
      background:var(--paper); border:1px solid var(--line); border-radius:var(--radius);
      padding:28px; box-shadow:0 10px 24px rgba(20,20,40,.05);
    }
    h1{margin:0 0 8px; font-size:28px}
    p.lead{margin:0 0 18px; color:var(--muted)}
    form{display:grid; gap:14px}
    .field{display:grid; gap:6px}
    label{font-size:14px; color:var(--muted)}
    input, textarea, select{
      border:1px solid var(--line); border-radius:12px; padding:12px 14px; font-size:16px;
      background:#fff;
    }
    textarea{min-height:110px; resize:vertical}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:14px}
    button{
      appearance:none; border:none; background:var(--accent); color:var(--accent-ink);
      font-weight:600; padding:12px 18px; border-radius:999px; cursor:pointer;
    }
    button:disabled{opacity:.6; cursor:not-allowed}
    .note{font-size:13px; color:var(--muted)}
    .ok{color:#126b36}
    .err{color:#8a1a1a}
    @media (max-width:600px){ .row{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>–¢—Ä–µ–∫–µ—Ä —Ä–∞—Å—Ö–æ–¥–æ–≤</h1>
      <p class="lead">–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É–º–º—É, –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É <code>expenses</code> (Supabase).</p>

      <form id="form">
        <div class="row">
          <div class="field">
            <label for="amount">–°—É–º–º–∞ (—Å –∫–æ–ø–µ–π–∫–∞–º–∏)*</label>
            <input id="amount" type="number" step="0.01" min="0" placeholder="–ù–∞–ø—Ä., 1250.50" required>
          </div>
          <div class="field">
            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è*</label>
            <input id="category" type="text" maxlength="100" placeholder="–ü—Ä–æ–¥—É–∫—Ç—ã / –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç / –ê—Ä–µ–Ω–¥–∞‚Ä¶" required>
          </div>
        </div>

        <div class="field">
          <label for="description">–¢–µ–∫—Å—Ç/–æ–ø–∏—Å–∞–Ω–∏–µ</label>
          <textarea id="description" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ —Ç—Ä–∞—Ç–µ: –≥–¥–µ, –∑–∞—á–µ–º, –¥–µ—Ç–∞–ª–∏‚Ä¶"></textarea>
        </div>

        <button id="saveBtn" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
        <div id="status" class="note"></div>
      </form>
    </div>
  </div>

  <!-- Supabase JS v2 —á–µ—Ä–µ–∑ CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // üîß –í–°–¢–ê–í–¨ –°–í–û–ò –ó–ù–ê–ß–ï–ù–ò–Ø
    const SUPABASE_URL = "https://aagyqcqciyojshlsioty.supabase.co"; // ‚Üê —Å—é–¥–∞ URL –ø—Ä–æ–µ–∫—Ç–∞
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFhZ3lxY3FjaXlvanNobHNpb3R5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyMjEyNTgsImV4cCI6MjA3OTc5NzI1OH0.mJ-xzXD5vkpjJt76WQkHMcd-I83Jfyq4fI_65C3P1ts"; // ‚Üê —Å—é–¥–∞ –ø—É–±–ª–∏—á–Ω—ã–π anon –∫–ª—é—á

    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById('form');
    const statusEl = document.getElementById('status');
    const btn = document.getElementById('saveBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      btn.disabled = true;

      const amount = parseFloat(document.getElementById('amount').value);
      const category = document.getElementById('category').value.trim();
      const description = document.getElementById('description').value.trim();

      if (isNaN(amount) || amount < 0 || !category) {
        statusEl.innerHTML = '<span class="err">–ü—Ä–æ–≤–µ—Ä—å —Å—É–º–º—É –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.</span>';
        btn.disabled = false;
        return;
      }

      // –¢–∞–±–ª–∏—Ü–∞ –∏ –∫–æ–ª–æ–Ω–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–≤–æ–µ–º—É SQL:
      // id (SERIAL, PK), category (VARCHAR), description (TEXT),
      // created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP), amount (DECIMAL(10,2))
      const { data, error } = await client
        .from('expenses')
        .insert([{ amount, category, description }]) // created_at –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è —Å–∞–º
        .select();

      if (error) {
        statusEl.innerHTML = '<span class="err">–û—à–∏–±–∫–∞: ' + (error.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ') + '</span>';
      } else {
        statusEl.innerHTML = '<span class="ok">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úî</span>';
        form.reset();
      }
      btn.disabled = false;
    });
  </script>
</body>
</html>